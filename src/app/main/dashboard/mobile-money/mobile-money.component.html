@if (currentStep == 'step-one') {
    <form #ngForm="ngForm" (ngSubmit)="triggerVerify()">
        <p class="title">Pay with Mobile Money</p>
        <p class="desc mt-1">Enter your details below to complete this transaction</p>
    
        <div class="mt-6">
            <div class="form-control w-full">
                <label class="label">
                  <span class="label-text">Select Provider</span>
                </label>
              
                <div class="flex justify-start items-center gap-2"> 
                  <div
                    *ngFor="let provider of momoNetworks"
                    class="relative cursor-pointer rounded-xl border-2 p-1 !px-1 flex justify-center items-center w-[50px]"
                    [ngClass]="{
                      'border-blue-500': selectedProvider?.bank_name === provider.bank_name,
                      'border-gray-300': selectedProvider?.bank_name !== provider.bank_name
                    }"
                    (click)="selectProvider(provider)"
                  >
                    <img
                      [src]="provider.imageUrl"
                      class="w-9 h-9 rounded-full"
                    />
                    <div
                      *ngIf="selectedProvider?.bank_name === provider.bank_name"
                      class="absolute top-1 right-1 bg-blue-500 text-white rounded-full p-1"
                    >
                      <svg xmlns="http://www.w3.org/2000/svg" class="w-2 h-2" fill="none"
                        viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7" />
                      </svg>
                    </div>
                  </div>
                </div>
              </div>
              
    
            <div class="mt-2">
                <label class="mb-1 input-label">Mobile Number</label>
                <input  [(ngModel)]="numberVerificationFormData.number" name="number" class="input-field" placeholder="Mobile number"  maxlength="11"
                    (keypress)="miscService.preventLetter($event)" required/>
            </div>
            <div class="mt-1 flex justify-end flex-wrap items-center ">
                @if (user) {
                    <p class="flex gap-2 items-center font-semibold">
                        <span class="text-[#0095FF] text-sm">{{user?.name}} </span>
                        <svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M6 12C9.31371 12 12 9.31371 12 6C12 2.68629 9.31371 0 6 0C2.68629 0 0 2.68629 0 6C0 9.31371 2.68629 12 6 12Z" fill="#4BD37B"/>
                            <path d="M8.80017 2.3999L4.60017 6.7199L3.20017 5.2799L1.80017 6.7199L4.60017 9.5999L10.2002 3.8399L8.80017 2.3999Z" fill="white"/>
                        </svg>                                                
                    </p>
                }
            </div>
    
           @if(user){
            <button (click)="triggerMomoPay()"  class="primaty-btn mt-4" >
                pay
            </button>
           } @else {
            <button type="submit" class="primaty-btn mt-4" [disabled]="ngForm.invalid || verifyLoading">
                @if(verifyLoading) {
                    <svg class="animate-spin -ml-1 mr-2 h-4 w-4 text-white inline" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                }
                Proceed
            </button>
           }
        </div>
    </form>
}

@if (currentStep === 'step-two') {
    <dialog #modalRef class="modal">
        <div class="modal-box w-[70%] lg:max-w-[28%] mx-2 sm:mx-4 md:mx-auto">
           @if(!paymentLoading){
            <form method="dialog">
                <button class="btn btn-sm btn-circle !border-none !outline-none btn-ghost absolute right-2 top-2">✕</button>
              </form>
           }
       
            @if(paymentLoading){
                <div class="w-[full] flex flex-col justify-center items-center">
                    <div class="mt-4 px-4 py-1 bg-blue-100 bg-opacity-60 dark:bg-opacity-60 text-blue-800 text-sm font-medium rounded-full inline-flex items-center ">
                        <svg class="w-4 h-4 mr-1.5" viewBox="0 0 22 22" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" 
                                  stroke="currentColor" 
                                  stroke-width="1.5" 
                                  stroke-linecap="round" 
                                  stroke-linejoin="round"
                                  fill="none"/>
                            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" 
                                  fill="currentColor" 
                                  fill-opacity="0.2"/>
                          </svg>
                        <span class="text-[11px]">Secured Transaction</span>
                      </div>
                      <hr>
                      <ng-lottie class="mt-[-60px]"
                      [options]="options"
                      width="200px"
                      height="200px"
                    />
                    <h3 class=" sm:text-lg md:text-xl font-medium mt-[-60px]">Confirming Transaction</h3>
                    <p class="text-[11px] text-gray-500 text-center" >Kindly approve the prompt sent to you</p>
                  
                  <div class=" px-4 py-2 bg-blue-100 mt-[5px]  bg-opacity-60  text-blue-800 text-sm font-medium rounded-full inline-flex items-center animate-pulse">
                    <svg class="w-3 h-3 mr-1.5 animate-spin" fill="none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                      <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 17.5228 6.47715 22 12 22Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M12 6V12L16 14" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                    <span class="text-[12px]">{{ displayTime }}s remaining</span>
                  </div>
                 
                </div>
            } @else{
                <div class="w-full">
                    <h3 class=" sm:text-lg md:text-xl font-medium">Feedback</h3>
                    <p class="!leading-snug mb-3 text-gray-600 font-normal !text-[13px] sm:text-base">
                        We can’t confirm this transaction yet, but we’ll update you soon.
                      </p>
                      
                      
                      <div class="flex flex-col sm:flex-row justify-end items-center w-full gap-2 sm:gap-3">
                        <button class="w-full sm:w-auto !outline-none border-[1px] p-1 px-3 sm:px-4 rounded-md border-gray-200 !text-[13px] !leading-snug ">Close payment and wait for feedback</button>
                        <button (click)="checkAgain()" class="w-full sm:w-auto py-1 lg:p-1 !px-4 sm:px-4 rounded-md bg-[#003e78] text-white !text-[14px] !leading-snug ">Check again</button>
                      </div>
                  </div>
            }
             
            <!-- <div class="flex flex-col sm:flex-row justify-end items-center w-full gap-2 sm:gap-3">
              <button class="w-full sm:w-auto border-[1px] p-1 px-3 sm:px-4 rounded-md border-gray-200 text-xs sm:text-sm md:text-base">Close payment and wait for feedback</button>
              <button (click)="checkAgain()" class="w-full sm:w-auto p-1 px-3 sm:px-4 rounded-md bg-[#003e78] text-white text-xs sm:text-sm md:text-base">Check again</button>
            </div> -->
          </div>
      
      </dialog>
    <div>
        <p class="title">Pay with Mobile Account</p>

        <p class="desc mt-1">
            Complete this transaction using your mobile device and click on the button below to confirm
        </p>
    
        <div class="mt-6">
            <button class="primaty-btn" (click)="confirmPayment()">
                I have made this payment
            </button>
        </div>
    </div>
}